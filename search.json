[{"path":"https://pablogguz.github.io/ineAtlas/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2024 ineAtlas authors Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"https://pablogguz.github.io/ineAtlas/articles/ineAtlas-income-voting.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Linking census tract-level income data to electoral outcomes with ineAtlas","text":"vignette demonstrates combine data Spanish Statistical Office’s Atlas (accessed ineAtlas) administrative data sources. ’ll analyze relationship income levels voting patterns Madrid’s census tracts using data 2021 regional elections.","code":""},{"path":"https://pablogguz.github.io/ineAtlas/articles/ineAtlas-income-voting.html","id":"required-packages","dir":"Articles","previous_headings":"","what":"Required packages","title":"Linking census tract-level income data to electoral outcomes with ineAtlas","text":"","code":"library(ggplot2) library(dplyr) library(tidyr) library(ineAtlas) library(extrafont) library(data.table) library(ggtext) library(stringr)"},{"path":"https://pablogguz.github.io/ineAtlas/articles/ineAtlas-income-voting.html","id":"getting-the-data","dir":"Articles","previous_headings":"","what":"Getting the data","title":"Linking census tract-level income data to electoral outcomes with ineAtlas","text":"’ll combine two data sources: 1. Income data census tract level 2. Electoral results Madrid’s 2021 regional elections First, let’s get election data: Now, let’s get income data Madrid’s census tracts using ineAtlas:","code":"# Electoral data elections_raw <- data.table::fread(     \"https://datos.comunidad.madrid/catalogo/dataset/08aac4de-ca28-4f9c-b45d-ef8457c4b5d2/resource/5e8cf4ad-b9f4-4ffd-a026-c27433e7815f/download/datos_electorales_elecciones_autonomicas_comunidad_de_madrid_2021.csv\",     sep = \";\",     encoding = \"Latin-1\" ) %>% as_tibble() # Get income data from ineAtlas income_data <- get_atlas(\"income\", \"tract\") %>%     # Filter for Madrid region     filter(substr(mun_code, 1, 2) == \"28\") %>%     filter(year == 2021)"},{"path":"https://pablogguz.github.io/ineAtlas/articles/ineAtlas-income-voting.html","id":"data-processing","dir":"Articles","previous_headings":"","what":"Data processing","title":"Linking census tract-level income data to electoral outcomes with ineAtlas","text":"need process election data merge income data:","code":"# Process election data to census tract level elections_proc <- elections_raw %>%     select(PP, `P.S.O.E.`, distrito, seccion, cod_muni, votos_electores) %>%     rename(         pp = PP,         psoe = `P.S.O.E.`,         total_votes = votos_electores     ) %>%     mutate(         cod_muni = str_pad(as.character(cod_muni), width = 3, pad = \"0\"),         distrito = str_pad(as.character(distrito), width = 2, pad = \"0\"),         seccion = str_pad(as.character(seccion), width = 3, pad = \"0\"),         tract_code = paste0(\"28\", cod_muni, distrito, seccion),         share_pp = pp / total_votes,         share_psoe = psoe / total_votes,         tract_code = as.character(tract_code)     )  # Merge and prepare for plotting plot_data <- elections_proc %>%     left_join(         income_data,         by = \"tract_code\"     ) %>%     mutate(income_percentile = percent_rank(net_income_pc)) %>%     select(income_percentile, share_pp, share_psoe, total_votes) %>%     pivot_longer(         cols = c(share_pp, share_psoe),         names_to = \"party\",         values_to = \"vote_share\"     )"},{"path":"https://pablogguz.github.io/ineAtlas/articles/ineAtlas-income-voting.html","id":"visualization","dir":"Articles","previous_headings":"","what":"Visualization","title":"Linking census tract-level income data to electoral outcomes with ineAtlas","text":"’ll create visualization showing voting patterns vary income levels across Madrid’s census tracts. particular, ’ll focus vote share two main parties, Popular Party (PP) Socialist Party (PSOE):","code":"ggplot() +     geom_point(data = plot_data,                aes(x = income_percentile * 100,                     y = vote_share * 100,                    color = party),                size = plot_data$total_votes/200,                alpha = 0.2) +     geom_smooth(data = plot_data,                 aes(x = income_percentile * 100,                     y = vote_share * 100,                     color = party),                 method = \"loess\",                 se = FALSE,                 linewidth = 1.5) +     scale_color_manual(         values = c(\"share_pp\" = \"#0066CC\", \"share_psoe\" = \"#E31C1C\"),         labels = c(\"share_pp\" = \"PP\", \"share_psoe\" = \"PSOE\"),         name = NULL     ) +     scale_y_continuous(labels = function(x) paste0(x, \"%\")) +     labs(         title = \"Voting patterns and income at the census tract-level (Madrid, 2021)\",         x = \"Equivalised net income percentile\",         y = \"Vote share\",         caption = \"@pablogguz_ | The chart shows the percent of total votes by party within each census tract in the Madrid 2021 regional election.         Source: Regional Government of Madrid, Spanish Statistical Office and author's calculations.\"     ) +     theme_minimal() +     theme(         text = element_text(family = \"Open Sans\", size = 16),         plot.title = element_text(size = 18, margin = margin(b = 20)),         plot.caption = element_textbox_simple(             size = 12,              color = \"grey40\",              margin = margin(t = 20),             hjust = 0  # This left-justifies the caption         ),         legend.position = \"top\",                 legend.justification = \"left\",         panel.grid.minor = element_blank(),         panel.grid.major.x = element_blank()     )"},{"path":"https://pablogguz.github.io/ineAtlas/articles/mapping-with-ineatlas.html","id":"load-required-packages","dir":"Articles","previous_headings":"","what":"Load required packages","title":"Creating maps with ineAtlas","text":"First, let’s load required packages. use mapSpain](https://ropenspain.github.io/mapSpain/) package get municipality geometries.","code":"library(ineAtlas) library(mapSpain) library(dplyr) library(ggplot2) library(ggtext)"},{"path":"https://pablogguz.github.io/ineAtlas/articles/mapping-with-ineatlas.html","id":"get-municipality-data","dir":"Articles","previous_headings":"","what":"Get municipality data","title":"Creating maps with ineAtlas","text":"Let’s fetch income data Spanish municipalities year 2022:","code":"# Get municipality level income data mun_data <- get_atlas(     category = \"income\",     level = \"municipality\" ) %>%     filter(year == 2022)  # Preview the data head(mun_data) #> # A tibble: 6 × 11 #>   mun_code mun_name  prov_code prov_name  year net_income_pc net_income_hh #>   <chr>    <chr>     <chr>     <chr>     <dbl>         <dbl>         <dbl> #> 1 02001    Abengibre 02        Albacete   2022         13063         32657 #> 2 02002    Alatoz    02        Albacete   2022         11346         24306 #> 3 02003    Albacete  02        Albacete   2022         13836         35722 #> 4 02004    Albatana  02        Albacete   2022         10767         23630 #> 5 02005    Alborea   02        Albacete   2022         10489         22177 #> 6 02006    Alcadozo  02        Albacete   2022         10709         23819 #> # ℹ 4 more variables: net_income_equiv <dbl>, median_income_equiv <dbl>, #> #   gross_income_pc <dbl>, gross_income_hh <dbl>"},{"path":"https://pablogguz.github.io/ineAtlas/articles/mapping-with-ineatlas.html","id":"get-municipality-geometries","dir":"Articles","previous_headings":"","what":"Get municipality geometries","title":"Creating maps with ineAtlas","text":"Now ’ll get municipality geometries mapSpain:","code":"# Get municipality geometries mun_map <- esp_get_munic_siane() %>%     # Join with our income data     left_join(         mun_data,         by = c(\"LAU_CODE\" = \"mun_code\")     )  # Preview the joined data glimpse(mun_map) #> Rows: 8,213 #> Columns: 18 #> $ codauto             <chr> \"01\", \"01\", \"01\", \"01\", \"01\", \"01\", \"01\", \"01\", \"0… #> $ ine.ccaa.name       <chr> \"Andalucía\", \"Andalucía\", \"Andalucía\", \"Andalucía\"… #> $ cpro                <chr> \"04\", \"04\", \"04\", \"04\", \"04\", \"04\", \"04\", \"04\", \"0… #> $ ine.prov.name       <chr> \"Almería\", \"Almería\", \"Almería\", \"Almería\", \"Almer… #> $ cmun                <chr> \"001\", \"002\", \"003\", \"004\", \"005\", \"006\", \"007\", \"… #> $ name                <chr> \"Abla\", \"Abrucena\", \"Adra\", \"Albanchez\", \"Albolodu… #> $ LAU_CODE            <chr> \"04001\", \"04002\", \"04003\", \"04004\", \"04005\", \"0400… #> $ mun_name            <chr> \"Abla\", \"Abrucena\", \"Adra\", \"Albanchez\", \"Albolodu… #> $ prov_code           <chr> \"04\", \"04\", \"04\", \"04\", \"04\", \"04\", \"04\", \"04\", \"0… #> $ prov_name           <chr> \"Almería\", \"Almería\", \"Almería\", \"Almería\", \"Almer… #> $ year                <dbl> 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 20… #> $ net_income_pc       <dbl> 11635, 10927, 9316, 10464, 11054, 9761, 10103, 120… #> $ net_income_hh       <dbl> 25522, 22066, 25639, 21030, 23237, 26991, 19494, 2… #> $ net_income_equiv    <dbl> 16511, 15129, 14206, 14958, 15436, 15267, 13757, 1… #> $ median_income_equiv <dbl> 15050, 13650, 12950, 13650, 14350, 13650, 12250, 1… #> $ gross_income_pc     <dbl> 13305, 12361, 10650, 11885, 12457, 11545, 11311, 1… #> $ gross_income_hh     <dbl> 29187, 24962, 29311, 23885, 26187, 31924, 21823, 3… #> $ geom                <MULTIPOLYGON [°]> MULTIPOLYGON (((-2.759034 3..., MULTI…"},{"path":"https://pablogguz.github.io/ineAtlas/articles/mapping-with-ineatlas.html","id":"create-a-choropleth-map","dir":"Articles","previous_headings":"","what":"Create a choropleth map","title":"Creating maps with ineAtlas","text":"Let’s create map showing net income per capita across Spanish municipalities:","code":"# Create the map ggplot(mun_map) +     geom_sf(         aes(fill = cut(net_income_pc,             breaks = c(-Inf, 8000, 10000, 12000, 14000, 16000, Inf),             labels = c(\"<8k\", \"8-10k\", \"10-12k\", \"12-14k\", \"14-16k\", \">16k\")         )),         color = NA     ) +     labs(         title = \"Income per capita across Spanish municipalities, 2022\",         caption = \"@pablogguz_ | The map shows net income per capita at the municipality level. Source: Spanish Statistical Office and author's calculations.\"     ) +     scale_fill_manual(         name = \"Net income per \\ncapita, 2022 (€)\",         values = c(\"#67001F\", \"#B2182B\", \"#D6604D\", \"#4393C3\", \"#2166AC\", \"#053061\"),         na.value = \"grey80\"     ) +     theme_void() +     theme(         text = element_text(family = \"Open Sans\", size = 16),         plot.title = element_text(size = 18, margin = margin(b = 20)),         legend.position = c(0.2, 0.5),         plot.caption = element_textbox_simple(             size = 12,             color = \"grey40\",             margin = margin(t = 20),             hjust = 0,             halign = 0,             lineheight = 1.2         )     )"},{"path":"https://pablogguz.github.io/ineAtlas/articles/mapping-with-ineatlas.html","id":"identifying-high-and-low-income-areas","dir":"Articles","previous_headings":"","what":"Identifying high and low income areas","title":"Creating maps with ineAtlas","text":"Let’s find top 10 municipalities net income per capita: bottom 10:","code":"mun_data %>%   arrange(desc(net_income_pc)) %>%   select(mun_name, net_income_pc) %>%   head(10) %>%   mutate(     net_income_pc = round(net_income_pc, 2)   ) #> # A tibble: 10 × 2 #>    mun_name                 net_income_pc #>    <chr>                            <dbl> #>  1 Pozuelo de Alarcón               29258 #>  2 Oroz-Betelu/Orotz-Betelu         25780 #>  3 Goñi                             25532 #>  4 Matadepera                       24814 #>  5 Bolvir                           24812 #>  6 Boadilla del Monte               24748 #>  7 Palau de Santa Eulàlia           24437 #>  8 Madremanya                       24190 #>  9 Vilamòs                          24052 #> 10 Brull, El                        23957 mun_data %>%   arrange(net_income_pc) %>%   select(mun_name, net_income_pc) %>%   head(10) %>%   mutate(     net_income_pc = round(net_income_pc, 2)   ) #> # A tibble: 10 × 2 #>    mun_name            net_income_pc #>    <chr>                       <dbl> #>  1 Odèn                         6274 #>  2 Torre del Burgo              6277 #>  3 Manjarrés                    7146 #>  4 Huesa                        7603 #>  5 Darro                        7712 #>  6 Guadahortuna                 7757 #>  7 Iznalloz                     7777 #>  8 Palmar de Troya, El          7779 #>  9 Albuñol                      7949 #> 10 Palomas                      8036"},{"path":"https://pablogguz.github.io/ineAtlas/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Pablo García Guzmán. Author, maintainer, copyright holder.","code":""},{"path":"https://pablogguz.github.io/ineAtlas/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"García Guzmán P (2024). ineAtlas: Access Spanish Household Income Distribution Atlas Data. R package version 0.1.0, https://pablogguz.github.io/ineAtlas/, https://github.com/pablogguz/ineAtlas.","code":"@Manual{,   title = {ineAtlas: Access to Spanish Household Income Distribution Atlas Data},   author = {Pablo {García Guzmán}},   year = {2024},   note = {R package version 0.1.0,     https://pablogguz.github.io/ineAtlas/},   url = {https://github.com/pablogguz/ineAtlas}, }"},{"path":"https://pablogguz.github.io/ineAtlas/index.html","id":"ineatlas-","dir":"","previous_headings":"","what":"Access to Spanish Household Income Distribution Atlas Data","title":"Access to Spanish Household Income Distribution Atlas Data","text":"goal ineAtlas package provide easy access granular socioeconomic indicators Spanish Statistical Office (INE) Atlas de Distribución de Renta de los Hogares (Household Income Distribution Atlas). dataset combines administrative tax data population statistics provide detailed information income distribution related socioeconomic indicators municipal, district, census tract levels.","code":""},{"path":"https://pablogguz.github.io/ineAtlas/index.html","id":"data-structure","dir":"","previous_headings":"","what":"Data structure","title":"Access to Spanish Household Income Distribution Atlas Data","text":"data organized several categories available three geographic levels: Municipality (Municipio) District (Distrito) Census tract (Sección censal)","code":""},{"path":"https://pablogguz.github.io/ineAtlas/index.html","id":"available-datasets","dir":"","previous_headings":"Data structure","what":"Available datasets","title":"Access to Spanish Household Income Distribution Atlas Data","text":"data stored accompanying ineAtlas.data repository. can find data dictionary information data structure https://pablogguz.github.io/ineAtlas.data/.","code":""},{"path":"https://pablogguz.github.io/ineAtlas/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Access to Spanish Household Income Distribution Atlas Data","text":"can install development version ineAtlas GitHub :","code":"# install.packages(\"pak\") pak::pak(\"pablogguz/ineAtlas\")"},{"path":"https://pablogguz.github.io/ineAtlas/index.html","id":"example","dir":"","previous_headings":"","what":"Example","title":"Access to Spanish Household Income Distribution Atlas Data","text":"’s basic example fetching census tract-level income data:","code":"library(ineAtlas)  # Get municipality-level income data income_data <- get_atlas(\"income\", \"tract\")  # View the first few rows head(income_data)"},{"path":"https://pablogguz.github.io/ineAtlas/index.html","id":"contributing","dir":"","previous_headings":"","what":"Contributing","title":"Access to Spanish Household Income Distribution Atlas Data","text":"Contributions welcome! Please feel free submit pull request. major changes, please open issue first discuss like change.","code":""},{"path":"https://pablogguz.github.io/ineAtlas/index.html","id":"author","dir":"","previous_headings":"","what":"Author","title":"Access to Spanish Household Income Distribution Atlas Data","text":"Pablo García Guzmán EBRD","code":""},{"path":"https://pablogguz.github.io/ineAtlas/reference/get_atlas.html","id":null,"dir":"Reference","previous_headings":"","what":"Fetch data from the ineAtlas data repository — get_atlas","title":"Fetch data from the ineAtlas data repository — get_atlas","text":"Downloads extracts compressed data files ineAtlas data repository, providing access various socioeconomic indicators different geographic levels.","code":""},{"path":"https://pablogguz.github.io/ineAtlas/reference/get_atlas.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Fetch data from the ineAtlas data repository — get_atlas","text":"","code":"get_atlas(category, level, cache = TRUE, cache_dir = tempdir())"},{"path":"https://pablogguz.github.io/ineAtlas/reference/get_atlas.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Fetch data from the ineAtlas data repository — get_atlas","text":"category Character string specifying data category. Must one : \"income\", \"income_sources\", \"demographics\", \"distribution_sex\", \"distribution_sex_age\", \"distribution_sex_nationality\" level Character string specifying geographic level. Must one : \"municipality\", \"district\", \"tract\" cache Logical indicating whether cache extracted data. Default TRUE. Cached data stored uncompressed faster access. cache_dir Character string specifying cache directory. Default tempdir().","code":""},{"path":"https://pablogguz.github.io/ineAtlas/reference/get_atlas.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Fetch data from the ineAtlas data repository — get_atlas","text":"tibble containing requested data. Distribution data include additional columns demographic breakdowns (sex, age, nationality). data automatically extracted compressed files cached locally requested.","code":""},{"path":"https://pablogguz.github.io/ineAtlas/reference/get_atlas.html","id":"note","dir":"Reference","previous_headings":"","what":"Note","title":"Fetch data from the ineAtlas data repository — get_atlas","text":"Data files stored compressed repository reduce size download times. function handles decompression automatically.","code":""},{"path":"https://pablogguz.github.io/ineAtlas/reference/get_atlas.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Fetch data from the ineAtlas data repository — get_atlas","text":"","code":"# \\donttest{ # Get municipality level income data income_data <- get_atlas(\"income\", \"municipality\") #> Downloading data from income_municipality.zip... #> Caching data to ineatlas_income_municipality.csv #> Data successfully loaded: 65008 rows, 11 columns  # Get district level demographics without caching demo_data <- get_atlas(\"demographics\", \"district\", cache = FALSE) #> Downloading data from demographics_district.zip... #> Data successfully loaded: 84128 rows, 13 columns  # Get income distribution indicators by sex sex_dist <- get_atlas(\"distribution_sex\", \"municipality\") #> Downloading data from distribution_sex_municipality.zip... #> Caching data to ineatlas_distribution_sex_municipality.csv #> Data successfully loaded: 194235 rows, 15 columns  # Get income distribution indicators by sex and age age_dist <- get_atlas(\"distribution_sex_age\", \"district\") #> Downloading data from distribution_sex_age_district.zip... #> Caching data to ineatlas_distribution_sex_age_district.csv #> Data successfully loaded: 753552 rows, 17 columns # }"},{"path":"https://pablogguz.github.io/ineAtlas/reference/get_tract_geom.html","id":null,"dir":"Reference","previous_headings":"","what":"Get census tract boundary geometries — get_tract_geom","title":"Get census tract boundary geometries — get_tract_geom","text":"Downloads extracts census tract boundary files ineAtlas repository, returning sf object geometries specified year.","code":""},{"path":"https://pablogguz.github.io/ineAtlas/reference/get_tract_geom.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get census tract boundary geometries — get_tract_geom","text":"","code":"get_tract_geom(year, cache = TRUE, cache_dir = tempdir())"},{"path":"https://pablogguz.github.io/ineAtlas/reference/get_tract_geom.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get census tract boundary geometries — get_tract_geom","text":"year Numeric. Year census tract boundaries retrieve (2015-2022) cache Logical indicating whether cache extracted data. Default TRUE. Cached data stored uncompressed faster access. cache_dir Character string specifying cache directory. Default tempdir().","code":""},{"path":"https://pablogguz.github.io/ineAtlas/reference/get_tract_geom.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get census tract boundary geometries — get_tract_geom","text":"sf object containing census tract boundaries following columns: year: reference year tract_code: Census tract identifier municipality: Municipality name province: Province name geometry: Census tract boundary geometry","code":""},{"path":"https://pablogguz.github.io/ineAtlas/reference/get_tract_geom.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Get census tract boundary geometries — get_tract_geom","text":"","code":"# \\donttest{ # Get census tract boundaries for 2020 tracts_2020 <- get_tract_geom(2020) #> Downloading geometries for 2020... #> Caching geometries to ineatlas_tracts_2020.gpkg #> Geometries successfully loaded: 36309 features  # Get boundaries without caching tracts_2019 <- get_tract_geom(2019, cache = FALSE) #> Downloading geometries for 2019... #> Geometries successfully loaded: 36317 features # }"},{"path":"https://pablogguz.github.io/ineAtlas/news/index.html","id":"ineatlas-010","dir":"Changelog","previous_headings":"","what":"ineAtlas 0.1.0","title":"ineAtlas 0.1.0","text":"Added get_tract_geom() function fetch census tract geometries","code":""},{"path":"https://pablogguz.github.io/ineAtlas/news/index.html","id":"ineatlas-0009000","dir":"Changelog","previous_headings":"","what":"ineAtlas 0.0.0.9000","title":"ineAtlas 0.0.0.9000","text":"Initial release","code":""}]
